<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>{title?? ?: 'Movie List'}</title>

        <!-- UIkit CSS -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/uikit@3.24.2/dist/css/uikit.min.css"
        />

        <!-- UIkit JS -->
        <script src="https://cdn.jsdelivr.net/npm/uikit@3.24.2/dist/js/uikit.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/uikit@3.24.2/dist/js/uikit-icons.min.js"></script>

        <!-- HTMX 2.0.8 -->
        <script
            src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js"
            integrity="sha384-/TgkGk7p307TH7EXJDuUlgG3Ce1UVolAOFopFekQkkXihi5u/6OCvVKyz1W+idaz"
            crossorigin="anonymous"
        ></script>

        <!-- Sortable.js for drag-and-drop -->
        <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

        <link rel="stylesheet" href="/style.css" />
    </head>
    <body>
        <nav class="uk-navbar-container" uk-navbar>
            <div class="uk-navbar-left">
                <a class="uk-navbar-item uk-logo" href="/">Movie List</a>
                <ul class="uk-navbar-nav">
                    {#if userName}
                    <li><a href="/films">Films</a></li>
                    <li>
                        <form action="/logout" method="post" style="display: inline;">
                            <button type="submit" class="uk-button uk-button-link uk-navbar-item">
                                Logout
                            </button>
                        </form>
                    </li>
                    {#else}
                    <li><a href="/login">Login</a></li>
                    <li><a href="/register">Register</a></li>
                    {/if}
                </ul>
            </div>
        </nav>

        <div class="uk-container uk-margin-large-top">
            {#insert}Default content{/insert}
        </div>

        <script>
            // Initialize Sortable.js on HTMX content load
            document.body.addEventListener('htmx:load', function(evt) {
                var sortables = evt.detail.elt.querySelectorAll('.sortable');
                sortables.forEach(function(sortable) {
                    if (!sortable.sortableInstance) {
                        sortable.sortableInstance = new Sortable(sortable, {
                            animation: 150,
                            ghostClass: 'uk-background-muted',
                            handle: '.drag-handle'
                        });
                    }
                });
            });

            // Initialize on page load
            document.addEventListener('DOMContentLoaded', function() {
                var sortables = document.querySelectorAll('.sortable');
                sortables.forEach(function(sortable) {
                    sortable.sortableInstance = new Sortable(sortable, {
                        animation: 150,
                        ghostClass: 'uk-background-muted',
                        handle: '.drag-handle'
                    });
                });
            });
        </script>
    </body>
</html>
